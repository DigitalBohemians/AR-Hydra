<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR Location ‚Äì Hydra</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { background: #000; overflow: hidden; font-family: sans-serif; }
      #overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.85);
        display: flex; flex-direction: column; align-items: center;
        justify-content: center; z-index: 9999; color: white;
        text-align: center; padding: 30px;
      }
      #overlay h1 { font-size: 26px; margin-bottom: 12px; }
      #overlay p  { font-size: 15px; color: #ccc; margin-bottom: 30px; line-height: 1.5; }
      #startBtn {
        padding: 16px 36px; font-size: 18px; font-weight: 700;
        background: #fff; color: #000; border: none;
        border-radius: 14px; cursor: pointer;
      }
      #status {
        position: fixed; top: 16px; left: 50%; transform: translateX(-50%);
        background: rgba(0,0,0,0.6); color: white; padding: 8px 16px;
        border-radius: 20px; font-size: 13px; z-index: 8888;
        display: none; text-align: center; max-width: 90vw;
      }
    </style>
  </head>
  <body>
    <div id="overlay">
      <h1>üó∫ AR auf Hydra</h1>
      <p>Diese Seite nutzt deine Kamera und deinen Standort.<br>Bitte beides erlauben wenn gefragt.</p>
      <button id="startBtn">‚ñ∂ AR Starten</button>
    </div>
    <div id="status">üìç GPS wird ermittelt‚Ä¶</div>

    <a-scene
      vr-mode-ui="enabled: false"
      renderer="antialias: true; alpha: true; logarithmicDepthBuffer: true;"
      arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
      loading-screen="enabled: false"
    >
      <a-assets>
        <a-asset-item id="model" src="./Test.glb"></a-asset-item>
        <audio id="musik" src="https://raw.githubusercontent.com/DigitalBohemians/AR-Hydra/main/paralia-hara.mp3" preload="auto"></audio>
      </a-assets>

      <a-entity
        gps-entity-place="latitude: 37.350000; longitude: 23.466767"
        look-at="[gps-camera]"
      >
        <!-- GLB Modell ‚Äì falls es l√§dt -->
        <a-entity
          gltf-model="#model"
          animation-mixer="loop: repeat"
          position="0 1 0"
          scale="5 5 5"
        ></a-entity>

        <!-- Fallback: sichtbare Formen falls GLB nicht l√§dt -->
        <a-sphere
          position="0 2 0"
          radius="0.8"
          color="#ff6600"
          opacity="0.9"
          animation="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear"
        ></a-sphere>

        <a-torus
          position="0 2 0"
          radius="1.2"
          radius-tubular="0.05"
          color="#00ffcc"
          animation="property: rotation; to: 360 0 360; loop: true; dur: 6000; easing: linear"
        ></a-torus>

        <a-text
          value="üèõ ARExhibition\nWillkommen auf Hydra!"
          color="white"
          align="center"
          width="6"
          position="0 4 0"
        ></a-text>

        <a-box
          position="0 4 -0.1"
          width="3.5"
          height="1.2"
          depth="0.05"
          color="#1a1a2e"
          opacity="0.8"
        ></a-box>

        <!-- Zylinder Boden -->
        <a-cylinder
          position="0 0.05 0"
          radius="1"
          height="0.15"
          color="#00ffcc"
          opacity="0.7"
          animation="property: material.opacity; from: 0.3; to: 0.9; loop: true; dur: 2000; direction: alternate"
        ></a-cylinder>

        <!-- Pulsierender Ring am Boden -->
        <a-torus
          position="0 0.1 0"
          radius="1.5"
          radius-tubular="0.03"
          color="#ffffff"
          opacity="0.4"
          rotation="90 0 0"
          animation="property: scale; from: 1 1 1; to: 1.3 1.3 1.3; loop: true; dur: 1500; direction: alternate; easing: easeInOutSine"
        ></a-torus>
      </a-entity>

      <a-camera gps-camera="minDistance: 1; gpsTimeInterval: 2000;" rotation-reader></a-camera>
    </a-scene>

    <script>
      const overlay  = document.getElementById('overlay');
      const startBtn = document.getElementById('startBtn');
      const status   = document.getElementById('status');

      startBtn.addEventListener('click', () => {
        overlay.style.display = 'none';
        status.style.display  = 'block';

        // Musik starten
        const musik = document.getElementById('musik');
        musik.loop   = true;
        musik.volume = 0.6;
        musik.play().catch(err => {
          console.warn('Musik konnte nicht gestartet werden:', err);
        });

        // iOS Kompass-Erlaubnis
        if (typeof DeviceOrientationEvent !== 'undefined' &&
            typeof DeviceOrientationEvent.requestPermission === 'function') {
          DeviceOrientationEvent.requestPermission()
            .then(response => {
              if (response === 'granted') {
                status.textContent = '‚úÖ Kompass aktiv ‚Äì GPS wird ermittelt‚Ä¶';
              } else {
                status.textContent = '‚ö†Ô∏è Kompass verweigert! Bitte in Einstellungen erlauben.';
              }
            })
            .catch(err => {
              status.textContent = '‚ö†Ô∏è Kompass Fehler: ' + err.message;
            });
        }

        // GPS Tracking
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(
            (pos) => {
              const lat = pos.coords.latitude.toFixed(5);
              const lon = pos.coords.longitude.toFixed(5);
              const acc = Math.round(pos.coords.accuracy);
              status.textContent = `üìç ${lat}, ${lon} (¬±${acc}m)`;
            },
            (err) => { status.textContent = '‚ö†Ô∏è GPS Fehler: ' + err.message; },
            { enableHighAccuracy: true, maximumAge: 0, timeout: 15000 }
          );
        } else {
          status.textContent = '‚ö†Ô∏è GPS nicht verf√ºgbar auf diesem Ger√§t.';
        }
      });
    </script>
  </body>
</html>
